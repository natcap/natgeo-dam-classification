<!doctype html>
<html>
<head>
<link rel="stylesheet" href="css/w3.css">
<style type="text/css">
    #mapid {
        height: 400px;
        width: 400px;
    }
    #infoBox {
        margin: auto;
        margin-bottom: 10px;
        width: 500px;
        font-size: small;
    }
    .column {
        padding-left:5%;
        padding-right:5%;
        float: left;
        width: 25%;
    }

    /* Clear floats after the columns */
    .row:after {
      content: "";
      display: table;
      clear: both;
    }

    table {
        font-size: small;
    }
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="css/Control.MiniMap.css" />
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2eva0nJdL6ngCWYqlzsOIjEOpvB75-AY " async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
<script src="js/leaflet-svg-shape-markers.min.js"></script>
<script src="https://unpkg.com/esri-leaflet@2.2.3/dist/esri-leaflet.js"
    integrity="sha512-YZ6b5bXRVwipfqul5krehD9qlbJzc6KOGXYsDjU9HHXW2gK57xmWl2gU6nAegiErAqFXhygKIsWPKbjLPXVb2g=="
    crossorigin=""></script>
<script src="js/Control.MiniMap.js" type="text/javascript"></script>

<script src='https://unpkg.com/leaflet.gridlayer.googlemutant@latest/Leaflet.GoogleMutant.js'></script>
<title>NatGeo Sentinel Image Trainer</title>
</head>
<body>
<h1><img src="images/natcap.png"/> & NatGeo Sentinel Dam Location Summary</h1>
<h2><a href="/">Back to validation</a></h2>
<hr>
<h2>Summary Stats</h2>
<div class="column">
    <div id="mapid"></div>
</div>
<div class="column" id="infoBox">
    <p><b>{{ total_count }}</b> total dam records.</p>
    <p><b>{{ total_count-unvalidated_count }}</b> dams validated,
       <b>{{ '%.2f%%' % (100.0*(total_count-unvalidated_count)/total_count) }}</b> complete.</p>
    <p><b>{{ count_with_bounding_box }}</b> validated dams have bounding boxes (<b>{{ '%.2f%%' % percent_with_bounding_box }}</b> of total dam records).</b></p>

    <h2>Top contributors</h2>
    <table>
        <tr><th>Username</th><th>Dams Processed</th></tr>
        {% for user_color, (username, count) in user_contribution_list %}
        <tr><td style="color:{{ user_color}};font-weight:bold;">
            {{ username }}</td><td>{{ count }}</td></tr>
        {% endfor %}
    </table>

    <h2>Databases Used</h2>
    <dl>
        {% for database_id, database_info in database_list %}
            <dt>{{ database_id }}</dt>
            <dd><a href="{{ database_info.database_url }}">{{ database_info.database_url }}</a></dd>
        {% endfor %}
    </dl>
</div>

</body>
<script type="text/javascript">
    var map = L.map('mapid', {
            preferCanvas: true
        });
    L.gridLayer.googleMutant({
            maxZoom: 24,
            type:'satellite'
    }).addTo(map);
    map.fitWorld();

    var valid_point_array = [];
    {% for user_color, point_list in user_color_point_list %}
        {% for lat,lng in point_list %}
            valid_point_array.push(
                L.circleMarker(
                    L.latLng({{ lat }},{{ lng }}),
                    {
                        'radius': 1,
                        'color': '{{ user_color }}',
                    }));
        {% endfor %}
    {% endfor %}
    var group = L.featureGroup(valid_point_array).addTo(map);

    setInterval(
        function() {
            $.ajax({
                url: '/calculate_user_contribution',
                type: 'GET',
                error: function (request, status, error) {
                    console.log(request.responseText);
                    console.log(status);
                    console.log(error);
                },
                success: function (data) {
                    console.log(data);
                    $.each(data, function(index, value) {
                        console.log(value);
                    });
                }
            });
        }, 1000);
</script>
</html>
